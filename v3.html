<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestión de Préstamos</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --success: #4cc9f0;
            --info: #4895ef;
            --warning: #f72585;
            --danger: #e63946;
            --light: #f8f9fa;
            --dark: #212529;
            --sidebar-width: 250px;
            --header-height: 70px;
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }
        
        body {
            background-color: #f5f7fb;
            color: #4a4a4a;
            overflow-x: hidden;
        }
        
        /* Login Screen */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }
        
        .login-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 420px;
            overflow: hidden;
            transition: var(--transition);
        }
        
        .login-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }
        
        .login-header {
            background: var(--primary);
            color: white;
            padding: 25px;
            text-align: center;
        }
        
        .login-header h2 {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .login-header p {
            opacity: 0.9;
            font-size: 0.9rem;
        }
        
        .login-body {
            padding: 25px;
        }
        
        .form-group {
            margin-bottom: 20px;
            position: relative;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }
        
        .form-control {
            border: 2px solid #e1e5eb;
            border-radius: 8px;
            padding: 12px 15px;
            transition: var(--transition);
        }
        
        .form-control:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.15);
        }
        
        .btn-primary {
            background: var(--primary);
            border: none;
            padding: 12px;
            font-weight: 500;
            border-radius: 8px;
            transition: var(--transition);
        }
        
        .btn-primary:hover {
            background: var(--secondary);
            transform: translateY(-2px);
        }
        
        .auth-switch {
            text-align: center;
            margin-top: 20px;
            font-size: 0.9rem;
        }
        
        /* Main Layout */
        .app-container {
            display: flex;
            min-height: 100vh;
        }
        
        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--dark);
            color: white;
            transition: var(--transition);
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            z-index: 1000;
            box-shadow: 3px 0 10px rgba(0, 0, 0, 0.1);
        }
        
        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }
        
        .sidebar-header h3 {
            font-weight: 600;
            font-size: 1.3rem;
            margin-bottom: 5px;
        }
        
        .sidebar-header p {
            font-size: 0.8rem;
            opacity: 0.7;
        }
        
        .sidebar-menu {
            padding: 15px 0;
        }
        
        .nav-item {
            margin: 5px 0;
        }
        
        .nav-link {
            color: rgba(255, 255, 255, 0.8);
            padding: 12px 20px;
            border-left: 4px solid transparent;
            transition: var(--transition);
            display: flex;
            align-items: center;
        }
        
        .nav-link:hover, .nav-link.active {
            color: white;
            background: rgba(255, 255, 255, 0.05);
            border-left-color: var(--primary);
        }
        
        .nav-link i {
            margin-right: 12px;
            font-size: 1.1rem;
            width: 24px;
            text-align: center;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            transition: var(--transition);
        }
        
        .header {
            height: var(--header-height);
            background: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            padding: 0 25px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .page-title h2 {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 5px;
        }
        
        .user-menu {
            display: flex;
            align-items: center;
        }
        
        .user-info {
            margin-right: 15px;
            text-align: right;
        }
        
        .user-info .user-name {
            font-weight: 500;
            color: var(--dark);
        }
        
        .user-info .user-role {
            font-size: 0.8rem;
            color: #6c757d;
        }
        
        .content {
            padding: 25px;
        }
        
        /* Dashboard Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: var(--transition);
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 15px;
        }
        
        .stat-content h3 {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 5px;
            font-family: 'Poppins', sans-serif;
        }
        
        .stat-content p {
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        /* Charts and Progress */
        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 25px;
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .chart-title {
            font-weight: 600;
            color: var(--dark);
        }
        
        .progress-bar {
            border-radius: 20px;
        }
        
        /* Tables */
        .data-table {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .table-header {
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #eee;
        }
        
        .table-title {
            font-weight: 600;
            color: var(--dark);
            margin: 0;
        }
        
        .table-responsive {
            overflow-x: auto;
        }
        
        .table th {
            font-weight: 600;
            color: #495057;
            border-top: none;
            border-bottom: 2px solid #e9ecef;
            padding: 15px;
            font-family: 'Poppins', sans-serif;
        }
        
        .table td {
            padding: 15px;
            vertical-align: middle;
            font-family: 'Poppins', sans-serif;
        }
        
        .badge {
            padding: 6px 10px;
            border-radius: 20px;
            font-weight: 500;
        }
        
        /* Forms */
        .form-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        /* Responsive */
        @media (max-width: 992px) {
            .sidebar {
                transform: translateX(-100%);
                width: 0;
            }
            
            .sidebar.active {
                transform: translateX(0);
                width: var(--sidebar-width);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .sidebar-toggle {
                display: block !important;
            }
        }
        
        .sidebar-toggle {
            display: none;
            background: var(--primary);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .sidebar-toggle:hover {
            background: var(--secondary);
        }
        
        /* Animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }
        
        .content-section {
            display: none;
        }
        
        .content-section.active {
            display: block;
        }
        
        /* Modal Styles */
        .modal-content {
            border-radius: 12px;
            border: none;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }
        
        .modal-header {
            background: var(--primary);
            color: white;
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
        }
        
        .btn-close {
            filter: invert(1);
        }
        
        /* Action buttons */
        .btn-action {
            width: 32px;
            height: 32px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            margin-right: 5px;
        }
        
        .alert-info {
            background-color: #e7f5ff;
            border-color: #c5ebff;
            color: #055160;
        }
    </style>
</head>
<body>
    <!-- Login Container -->
    <div id="login-container" class="login-container">
        <div class="login-card">
            <div class="login-header">
                <h2>Sistema de Préstamos</h2>
                <p>Inicia sesión para acceder a tu panel</p>
            </div>
            <div class="login-body">
                <form id="login-form">
                    <div class="form-group">
                        <label for="username">Usuario</label>
                        <input type="text" class="form-control" id="username" placeholder="Ingresa tu usuario" required>
                    </div>
                    <div class="form-group">
                        <label for="password">Contraseña</label>
                        <input type="password" class="form-control" id="password" placeholder="Ingresa tu contraseña" required>
                    </div>
                    <button type="submit" class="btn btn-primary w-100">Iniciar Sesión</button>
                    <div class="auth-switch">
                        <p>¿No tienes cuenta? <a href="#" id="show-register">Regístrate aquí</a></p>
                    </div>
                </form>
                
                <form id="register-form" class="d-none">
                    <div class="form-group">
                        <label for="reg-name">Nombre completo</label>
                        <input type="text" class="form-control" id="reg-name" placeholder="Ej: Juan Pérez" required>
                    </div>
                    <div class="form-group">
                        <label for="reg-username">Usuario</label>
                        <input type="text" class="form-control" id="reg-username" placeholder="Crea un nombre de usuario" required>
                    </div>
                    <div class="form-group">
                        <label for="reg-password">Contraseña</label>
                        <input type="password" class="form-control" id="reg-password" placeholder="Crea una contraseña segura" required>
                    </div>
                    <div class="form-group">
                        <label for="reg-email">Email</label>
                        <input type="email" class="form-control" id="reg-email" placeholder="Ej: ejemplo@correo.com" required>
                    </div>
                    <div class="form-group">
                        <label for="reg-phone">Teléfono</label>
                        <input type="tel" class="form-control" id="reg-phone" placeholder="Ej: +1234567890">
                    </div>
                    <button type="submit" class="btn btn-primary w-100">Registrarse</button>
                    <div class="auth-switch">
                        <p>¿Ya tienes cuenta? <a href="#" id="show-login">Inicia sesión</a></p>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Main Application -->
    <div id="app-container" class="app-container d-none">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h3>Sistema de Préstamos</h3>
                <p id="sidebar-username">Usuario</p>
            </div>
            <div class="sidebar-menu">
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link active" href="#dashboard" data-section="dashboard">
                            <i class="fas fa-tachometer-alt"></i> Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#clientes" data-section="clientes">
                            <i class="fas fa-users"></i> Clientes
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#creditos" data-section="creditos">
                            <i class="fas fa-hand-holding-usd"></i> Créditos
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#pagos" data-section="pagos">
                            <i class="fas fa-money-bill-wave"></i> Pagos
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#objetivo" data-section="objetivo">
                            <i class="fas fa-bullseye"></i> Objetivo Mensual
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#reportes" data-section="reportes">
                            <i class="fas fa-chart-bar"></i> Reportes
                        </a>
                    </li>
                    <li class="nav-item mt-4">
                        <a class="nav-link" href="#" id="logout-btn">
                            <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <div class="header">
                <button class="sidebar-toggle" id="sidebar-toggle">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="page-title">
                    <h2 id="page-title">Dashboard</h2>
                </div>
                <div class="user-menu">
                    <div class="user-info">
                        <div class="user-name" id="header-username">Usuario</div>
                        <div class="user-role">Cobrador</div>
                    </div>
                    <div class="user-avatar">
                        <img src="https://ui-avatars.com/api/?name=Usuario&background=4361ee&color=fff&rounded=true&size=40" alt="Usuario" class="rounded-circle">
                    </div>
                </div>
            </div>
            
            <!-- Content Area -->
            <div class="content">
                <!-- Dashboard Section -->
                <div id="dashboard-section" class="content-section active">
                    <div class="stats-grid">
                        <div class="stat-card fade-in">
                            <div class="stat-icon bg-primary bg-opacity-10 text-primary">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-content">
                                <h3 id="stat-clientes">0</h3>
                                <p>Clientes Registrados</p>
                            </div>
                        </div>
                        <div class="stat-card fade-in">
                            <div class="stat-icon bg-info bg-opacity-10 text-info">
                                <i class="fas fa-hand-holding-usd"></i>
                            </div>
                            <div class="stat-content">
                                <h3 id="stat-creditos">0</h3>
                                <p>Créditos Activos</p>
                            </div>
                        </div>
                        <div class="stat-card fade-in">
                            <div class="stat-icon bg-success bg-opacity-10 text-success">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                            <div class="stat-content">
                                <h3 id="stat-pagos">0</h3>
                                <p>Pagos Este Mes</p>
                            </div>
                        </div>
                        <div class="stat-card fade-in">
                            <div class="stat-icon bg-warning bg-opacity-10 text-warning">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="stat-content">
                                <h3 id="stat-eficiencia">0%</h3>
                                <p>Eficiencia</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-lg-8">
                            <div class="chart-container mb-4">
                                <div class="chart-header">
                                    <h4 class="chart-title">Objetivo Mensual</h4>
                                </div>
                                <div class="chart-body">
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Progreso: <strong id="objetivo-progress">0%</strong></span>
                                        <span><strong id="objetivo-actual">$0</strong> / <strong id="objetivo-total">$0</strong></span>
                                    </div>
                                    <div class="progress mb-4" style="height: 12px;">
                                        <div id="objetivo-progress-bar" class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <h5 class="m-0">Comisión Estimada: <span class="text-primary">$<span id="comision-estimada">0</span></span></h5>
                                        <button class="btn btn-sm btn-outline-primary" data-section="objetivo">Editar Objetivo</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="chart-container mb-4">
                                <div class="chart-header">
                                    <h4 class="chart-title">Eficiencia</h4>
                                </div>
                                <div class="chart-body text-center">
                                    <div class="efficiency-circle mx-auto mb-3" style="width: 120px; height: 120px; border-radius: 50%; background: conic-gradient(var(--primary) 0%, #e9ecef 0%); display: flex; align-items: center; justify-content: center;">
                                        <div style="width: 100px; height: 100px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                            <span id="eficiencia-circle-text" style="font-weight: 600; font-size: 1.5rem;">0%</span>
                                        </div>
                                    </div>
                                    <p class="text-muted">Basado en pagos cobrados vs créditos asignados</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="data-table mb-4">
                                <div class="table-header">
                                    <h4 class="table-title">Últimos Pagos</h4>
                                    <button class="btn btn-sm btn-primary" data-section="pagos">Ver Todos</button>
                                </div>
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Cliente</th>
                                                <th>Monto</th>
                                                <th>Fecha</th>
                                            </tr>
                                        </thead>
                                        <tbody id="ultimos-pagos-table">
                                            <tr>
                                                <td colspan="3" class="text-center py-4">No hay pagos recientes</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="data-table mb-4">
                                <div class="table-header">
                                    <h4 class="table-title">Próximos Vencimientos</h4>
                                    <button class="btn btn-sm btn-primary" data-section="creditos">Ver Todos</button>
                                </div>
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Cliente</th>
                                                <th>Monto</th>
                                                <th>Fecha</th>
                                            </tr>
                                        </thead>
                                        <tbody id="proximos-vencimientos-table">
                                            <tr>
                                                <td colspan="3" class="text-center py-4">No hay vencimientos próximos</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Clientes Section -->
                <div id="clientes-section" class="content-section">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2>Gestión de Clientes</h2>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#clienteModal">
                            <i class="fas fa-plus me-1"></i> Nuevo Cliente
                        </button>
                    </div>
                    
                    <div class="data-table">
                        <div class="table-header">
                            <h4 class="table-title">Lista de Clientes</h4>
                            <div class="input-group" style="max-width: 300px;">
                                <input type="text" id="search-cliente" class="form-control" placeholder="Buscar cliente...">
                                <button class="btn btn-outline-secondary" type="button">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-hover" id="clientes-table">
                                <thead>
                                    <tr>
                                        <th>Nombre</th>
                                        <th>Teléfono</th>
                                        <th>Email</th>
                                        <th>Dirección</th>
                                        <th>Créditos Activos</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Los clientes se cargarán dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Creditos Section -->
                <div id="creditos-section" class="content-section">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2>Gestión de Créditos</h2>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#creditoModal">
                            <i class="fas fa-plus me-1"></i> Nuevo Crédito
                        </button>
                    </div>
                    
                    <div class="data-table">
                        <div class="table-header">
                            <h4 class="table-title">Lista de Créditos</h4>
                            <div class="btn-group">
                                <button class="btn btn-outline-primary active">Todos</button>
                                <button class="btn btn-outline-primary">Activos</button>
                                <button class="btn btn-outline-primary">Pagados</button>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-hover" id="creditos-table">
                                <thead>
                                    <tr>
                                        <th>Cliente</th>
                                        <th>Monto</th>
                                        <th>Fecha</th>
                                        <th>Cuota</th>
                                        <th>Interés</th>
                                        <th>Estado</th>
                                        <th>Saldo Pendiente</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Los créditos se cargarán dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Pagos Section -->
                <div id="pagos-section" class="content-section">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2>Registro de Pagos</h2>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#pagoModal">
                            <i class="fas fa-plus me-1"></i> Registrar Pago
                        </button>
                    </div>
                    
                    <div class="data-table">
                        <div class="table-header">
                            <h4 class="table-title">Historial de Pagos</h4>
                            <div class="input-group" style="max-width: 250px;">
                                <input type="month" id="filter-month" class="form-control" value="">
                                <button class="btn btn-outline-secondary" type="button">
                                    <i class="fas fa-filter"></i>
                                </button>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-hover" id="pagos-table">
                                <thead>
                                    <tr>
                                        <th>Cliente</th>
                                        <th>Crédito</th>
                                        <th>Fecha Pago</th>
                                        <th>Monto</th>
                                        <th>Método</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Los pagos se cargarán dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Objetivo Section -->
                <div id="objetivo-section" class="content-section">
                    <div class="row justify-content-center">
                        <div class="col-lg-8">
                            <div class="form-card">
                                <h3 class="mb-4">Objetivo Mensual</h3>
                                <form id="objetivo-form">
                                    <div class="mb-3">
                                        <label for="objetivo-mensual" class="form-label">Establecer objetivo de cobranza mensual</label>
                                        <div class="input-group">
                                            <span class="input-group-text">$</span>
                                            <input type="number" class="form-control" id="objetivo-mensual" min="0" step="0.01" required>
                                        </div>
                                        <div class="form-text">Este objetivo se utiliza para calcular tu eficiencia y comisión.</div>
                                    </div>
                                    <button type="submit" class="btn btn-primary">Guardar Objetivo</button>
                                </form>
                                
                                <hr class="my-4">
                                
                                <div class="mt-4">
                                    <h5 class="mb-3">Resumen del Mes Actual</h5>
                                    <div class="d-flex justify-content-between mt-3">
                                        <span>Total Cobrado:</span>
                                        <strong id="total-cobrado-mes">$0.00</strong>
                                    </div>
                                    <div class="d-flex justify-content-between mt-2">
                                        <span>Objetivo:</span>
                                        <strong id="objetivo-actual-mes">$0.00</strong>
                                    </div>
                                    <div class="d-flex justify-content-between mt-2">
                                        <span>Porcentaje de cumplimiento:</span>
                                        <strong id="porcentaje-cumplimiento">0%</strong>
                                    </div>
                                    <div class="progress mt-3" style="height: 12px;">
                                        <div id="progress-bar-cumplimiento" class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Reportes Section -->
                <div id="reportes-section" class="content-section">
                    <h2 class="mb-4">Reportes y Estadísticas</h2>
                    
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="form-card">
                                <h4 class="mb-3">Generar Reporte</h4>
                                <form id="reporte-form">
                                    <div class="mb-3">
                                        <label for="reporte-tipo" class="form-label">Tipo de Reporte</label>
                                        <select class="form-select" id="reporte-tipo">
                                            <option value="pagos">Pagos del Mes</option>
                                            <option value="creditos">Créditos Activos</option>
                                            <option value="clientes">Clientes por Cobrador</option>
                                            <option value="comisiones">Comisiones</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="reporte-fecha" class="form-label">Período</label>
                                        <div class="input-group">
                                            <input type="month" class="form-control" id="reporte-fecha" value="">
                                        </div>
                                    </div>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-download me-1"></i> Generar Reporte
                                    </button>
                                </form>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="chart-container h-100">
                                <div class="chart-header">
                                    <h4 class="chart-title">Estadísticas de Pagos</h4>
                                </div>
                                <div class="chart-body">
                                    <canvas id="pagos-chart" height="250"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="data-table">
                        <div class="table-header">
                            <h4 class="table-title">Resumen de Eficiencia</h4>
                            <div class="btn-group">
                                <button class="btn btn-outline-primary active">Mensual</button>
                                <button class="btn btn-outline-primary">Trimestral</button>
                                <button class="btn btn-outline-primary">Anual</button>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Mes</th>
                                        <th>Total Cobrado</th>
                                        <th>Objetivo</th>
                                        <th>Eficiencia</th>
                                        <th>Comisión</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Mayo 2023</td>
                                        <td>$4,250.00</td>
                                        <td>$5,000.00</td>
                                        <td><span class="badge bg-warning">85.0%</span></td>
                                        <td>$212.50</td>
                                    </tr>
                                    <tr>
                                        <td>Abril 2023</td>
                                        <td>$5,300.00</td>
                                        <td>$4,500.00</td>
                                        <td><span class="badge bg-success">117.8%</span></td>
                                        <td>$265.00</td>
                                    </tr>
                                    <tr>
                                        <td>Marzo 2023</td>
                                        <td>$3,800.00</td>
                                        <td>$4,000.00</td>
                                        <td><span class="badge bg-info">95.0%</span></td>
                                        <td>$190.00</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para agregar/editar cliente -->
    <div class="modal fade" id="clienteModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="clienteModalTitle">Nuevo Cliente</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="cliente-form">
                        <input type="hidden" id="cliente-id">
                        <div class="mb-3">
                            <label for="cliente-nombre" class="form-label">Nombre completo</label>
                            <input type="text" class="form-control" id="cliente-nombre" required>
                        </div>
                        <div class="mb-3">
                            <label for="cliente-telefono" class="form-label">Teléfono</label>
                            <input type="tel" class="form-control" id="cliente-telefono">
                        </div>
                        <div class="mb-3">
                            <label for="cliente-email" class="form-label">Email</label>
                            <input type="email" class="form-control" id="cliente-email">
                        </div>
                        <div class="mb-3">
                            <label for="cliente-direccion" class="form-label">Dirección</label>
                            <textarea class="form-control" id="cliente-direccion" rows="2"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="save-cliente">Guardar</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal para agregar/editar crédito -->
    <div class="modal fade" id="creditoModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="creditoModalTitle">Nuevo Crédito</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="credito-form">
                        <input type="hidden" id="credito-id">
                        <div class="mb-3">
                            <label for="credito-cliente" class="form-label">Cliente</label>
                            <select class="form-select" id="credito-cliente" required>
                                <option value="">Seleccionar cliente</option>
                                <!-- Las opciones se cargarán dinámicamente -->
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="credito-monto" class="form-label">Monto del crédito</label>
                            <div class="input-group">
                                <span class="input-group-text">$</span>
                                <input type="number" class="form-control" id="credito-monto" min="0" step="0.01" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="credito-fecha" class="form-label">Fecha de préstamo</label>
                            <input type="date" class="form-control" id="credito-fecha" required>
                        </div>
                        <div class="mb-3">
                            <label for="credito-plazo" class="form-label">Plazo (meses)</label>
                            <input type="number" class="form-control" id="credito-plazo" min="1" required>
                        </div>
                        <div class="mb-3">
                            <label for="credito-interes" class="form-label">Tasa de interés mensual (%)</label>
                            <input type="number" class="form-control" id="credito-interes" min="0" step="0.1" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="save-credito">Guardar</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal para registrar pago -->
    <div class="modal fade" id="pagoModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Registrar Pago</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="pago-form">
                        <input type="hidden" id="pago-id">
                        <div class="mb-3">
                            <label for="pago-credito" class="form-label">Seleccionar Crédito</label>
                            <select class="form-select" id="pago-credito" required>
                                <option value="">Seleccionar crédito</option>
                                <!-- Las opciones se cargarán dinámicamente -->
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="pago-monto" class="form-label">Monto del pago</label>
                            <div class="input-group">
                                <span class="input-group-text">$</span>
                                <input type="number" class="form-control" id="pago-monto" min="0" step="0.01" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="pago-fecha" class="form-label">Fecha de pago</label>
                            <input type="date" class="form-control" id="pago-fecha" required>
                        </div>
                        <div class="mb-3">
                            <label for="pago-metodo" class="form-label">Método de pago</label>
                            <select class="form-select" id="pago-metodo" required>
                                <option value="Efectivo">Efectivo</option>
                                <option value="Transferencia">Transferencia</option>
                                <option value="Tarjeta">Tarjeta de débito/crédito</option>
                                <option value="Otro">Otro</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="save-pago">Registrar Pago</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS y Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script>
        // Variables globales
        let currentUser = null;
        let users = JSON.parse(localStorage.getItem('loanUsers')) || [];
        let clients = JSON.parse(localStorage.getItem('loanClients')) || [];
        let credits = JSON.parse(localStorage.getItem('loanCredits')) || [];
        let payments = JSON.parse(localStorage.getItem('loanPayments')) || [];
        
        // Inicialización cuando el DOM está listo
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar si hay una sesión activa
            const loggedInUser = localStorage.getItem('loggedInUser');
            if (loggedInUser) {
                currentUser = JSON.parse(loggedInUser);
                showMainPanel();
            }
            
            // Event listeners para formularios de login/registro
            document.getElementById('login-form').addEventListener('submit', handleLogin);
            document.getElementById('register-form').addEventListener('submit', handleRegister);
            document.getElementById('show-register').addEventListener('click', showRegisterForm);
            document.getElementById('show-login').addEventListener('click', showLoginForm);
            document.getElementById('logout-btn').addEventListener('click', handleLogout);
            
            // Event listeners para navegación
            document.querySelectorAll('.nav-link[data-section]').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    showSection(this.getAttribute('data-section'));
                });
            });
            
            // Event listeners para formularios de gestión
            document.getElementById('objetivo-form').addEventListener('submit', handleObjetivo);
            document.getElementById('save-cliente').addEventListener('click', saveCliente);
            document.getElementById('save-credito').addEventListener('click', saveCredito);
            document.getElementById('save-pago').addEventListener('click', savePago);
            document.getElementById('reporte-form').addEventListener('submit', generateReport);
            
            // Event listeners para botones que cambian de sección
            document.querySelectorAll('button[data-section]').forEach(btn => {
                btn.addEventListener('click', function() {
                    showSection(this.getAttribute('data-section'));
                });
            });
            
            // Inicializar modales de Bootstrap
            const clienteModal = new bootstrap.Modal(document.getElementById('clienteModal'));
            const creditoModal = new bootstrap.Modal(document.getElementById('creditoModal'));
            const pagoModal = new bootstrap.Modal(document.getElementById('pagoModal'));
            
            // Eventos para cuando se abren los modales
            document.getElementById('creditoModal').addEventListener('show.bs.modal', function() {
                loadClientOptions();
            });
            
            document.getElementById('pagoModal').addEventListener('show.bs.modal', function() {
                loadCreditOptions();
            });
            
            // Eventos para cuando se cierran los modales
            document.getElementById('clienteModal').addEventListener('hidden.bs.modal', resetClienteForm);
            document.getElementById('creditoModal').addEventListener('hidden.bs.modal', resetCreditoForm);
            document.getElementById('pagoModal').addEventListener('hidden.bs.modal', resetPagoForm);
            
            // Inicializar gráfico de reportes
            initReportsChart();
            
            // Configurar fecha actual en filtros
            const now = new Date();
            document.getElementById('filter-month').value = `${now.getFullYear()}-${(now.getMonth()+1).toString().padStart(2, '0')}`;
            document.getElementById('reporte-fecha').value = `${now.getFullYear()}-${(now.getMonth()+1).toString().padStart(2, '0')}`;
            
            // Menú responsive
            document.getElementById('sidebar-toggle').addEventListener('click', function() {
                document.querySelector('.sidebar').classList.toggle('active');
            });
        });
        
        // Función para manejar el inicio de sesión
        function handleLogin(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            const user = users.find(u => u.username === username && u.password === password);
            
            if (user) {
                currentUser = user;
                localStorage.setItem('loggedInUser', JSON.stringify(user));
                showMainPanel();
            } else {
                alert('Usuario o contraseña incorrectos');
            }
        }
        
        // Función para manejar el registro de nuevos usuarios
        function handleRegister(e) {
            e.preventDefault();
            const name = document.getElementById('reg-name').value;
            const username = document.getElementById('reg-username').value;
            const password = document.getElementById('reg-password').value;
            const email = document.getElementById('reg-email').value;
            const phone = document.getElementById('reg-phone').value;
            
            // Verificar si el usuario ya existe
            if (users.some(u => u.username === username)) {
                alert('El nombre de usuario ya está en uso');
                return;
            }
            
            const newUser = {
                id: Date.now().toString(),
                name,
                username,
                password,
                email,
                phone,
                monthlyGoal: 0,
                efficiency: 0,
                commissionRate: 0.05 // Comisión base del 5%
            };
            
            users.push(newUser);
            localStorage.setItem('loanUsers', JSON.stringify(users));
            
            alert('Registro exitoso. Ahora puedes iniciar sesión.');
            showLoginForm();
        }
        
        // Función para mostrar el formulario de registro
        function showRegisterForm(e) {
            if (e) e.preventDefault();
            document.getElementById('login-form').classList.add('d-none');
            document.getElementById('register-form').classList.remove('d-none');
        }
        
        // Función para mostrar el formulario de login
        function showLoginForm(e) {
            if (e) e.preventDefault();
            document.getElementById('register-form').classList.add('d-none');
            document.getElementById('login-form').classList.remove('d-none');
        }
        
        // Función para mostrar el panel principal
        function showMainPanel() {
            document.getElementById('login-container').classList.add('d-none');
            document.getElementById('app-container').classList.remove('d-none');
            
            // Actualizar la interfaz con los datos del usuario
            document.getElementById('sidebar-username').textContent = currentUser.name;
            document.getElementById('header-username').textContent = currentUser.name;
            
            // Cargar datos y mostrar el dashboard por defecto
            loadUserData();
            showSection('dashboard');
        }
        
        // Función para manejar el cierre de sesión
        function handleLogout(e) {
            e.preventDefault();
            currentUser = null;
            localStorage.removeItem('loggedInUser');
            document.getElementById('app-container').classList.add('d-none');
            document.getElementById('login-container').classList.remove('d-none');
            
            // Resetear formularios
            document.getElementById('login-form').reset();
            document.getElementById('register-form').reset();
            showLoginForm();
        }
        
        // Función para cambiar entre secciones
        function showSection(sectionId) {
            // Ocultar todas las secciones
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Mostrar la sección seleccionada
            document.getElementById(`${sectionId}-section`).classList.add('active');
            
            // Actualizar título de página
            document.getElementById('page-title').textContent = getSectionTitle(sectionId);
            
            // Actualizar navegación activa
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            document.querySelector(`.nav-link[data-section="${sectionId}"]`).classList.add('active');
            
            // Cargar datos específicos de la sección
            switch(sectionId) {
                case 'dashboard':
                    updateDashboard();
                    break;
                case 'clientes':
                    loadClientesTable();
                    break;
                case 'creditos':
                    loadCreditosTable();
                    break;
                case 'pagos':
                    loadPagosTable();
                    break;
                case 'objetivo':
                    loadObjetivoData();
                    break;
                case 'reportes':
                    loadReportsData();
                    break;
            }
            
            // Cerrar sidebar en móviles
            if (window.innerWidth < 992) {
                document.querySelector('.sidebar').classList.remove('active');
            }
        }
        
        function getSectionTitle(sectionId) {
            const titles = {
                'dashboard': 'Dashboard',
                'clientes': 'Gestión de Clientes',
                'creditos': 'Gestión de Créditos',
                'pagos': 'Registro de Pagos',
                'objetivo': 'Objetivo Mensual',
                'reportes': 'Reportes y Estadísticas'
            };
            return titles[sectionId] || 'Dashboard';
        }
        
        // Función para cargar los datos del usuario actual
        function loadUserData() {
            // Filtrar clientes, créditos y pagos del usuario actual
            clients = JSON.parse(localStorage.getItem('loanClients')) || [];
            credits = JSON.parse(localStorage.getItem('loanCredits')) || [];
            payments = JSON.parse(localStorage.getItem('loanPayments')) || [];
            
            // Actualizar el usuario actual con los datos más recientes
            const updatedUser = users.find(u => u.id === currentUser.id);
            if (updatedUser) {
                currentUser = updatedUser;
                localStorage.setItem('loggedInUser', JSON.stringify(currentUser));
            }
        }
        
        // Función para actualizar el dashboard
        function updateDashboard() {
            // Obtener datos actualizados
            loadUserData();
            
            // Calcular estadísticas
            const userClients = clients.filter(c => c.userId === currentUser.id);
            const userCredits = credits.filter(c => c.userId === currentUser.id);
            const userPayments = payments.filter(p => p.userId === currentUser.id);
            
            // Créditos activos (con saldo pendiente > 0)
            const activeCredits = userCredits.filter(c => c.balance > 0);
            
            // Pagos del mes actual
            const currentDate = new Date();
            const currentMonth = currentDate.getMonth();
            const currentYear = currentDate.getFullYear();
            const currentMonthPayments = userPayments.filter(p => {
                const paymentDate = new Date(p.date);
                return paymentDate.getMonth() === currentMonth && 
                       paymentDate.getFullYear() === currentYear;
            });
            
            // Calcular eficiencia
            calculateEfficiency();
            
            // Actualizar UI
            document.getElementById('stat-clientes').textContent = userClients.length;
            document.getElementById('stat-creditos').textContent = activeCredits.length;
            document.getElementById('stat-pagos').textContent = currentMonthPayments.length;
            document.getElementById('stat-eficiencia').textContent = `${currentUser.efficiency}%`;
            
            // Actualizar objetivo mensual
            const totalCollected = currentMonthPayments.reduce((sum, p) => sum + p.amount, 0);
            const goalProgress = currentUser.monthlyGoal > 0 ? (totalCollected / currentUser.monthlyGoal) * 100 : 0;
            
            document.getElementById('objetivo-progress').textContent = `${goalProgress.toFixed(1)}%`;
            document.getElementById('objetivo-actual').textContent = `$${totalCollected.toFixed(2)}`;
            document.getElementById('objetivo-total').textContent = `$${currentUser.monthlyGoal.toFixed(2)}`;
            
            const progressBar = document.getElementById('objetivo-progress-bar');
            progressBar.style.width = `${goalProgress}%`;
            progressBar.setAttribute('aria-valuenow', goalProgress);
            
            // Asignar clase de color según el progreso
            if (goalProgress >= 100) {
                progressBar.className = 'progress-bar bg-success';
            } else if (goalProgress >= 70) {
                progressBar.className = 'progress-bar bg-warning';
            } else {
                progressBar.className = 'progress-bar bg-danger';
            }
            
            // Calcular comisión estimada
            const commission = totalCollected * currentUser.commissionRate;
            document.getElementById('comision-estimada').textContent = commission.toFixed(2);
            
            // Actualizar círculo de eficiencia
            document.getElementById('eficiencia-circle-text').textContent = `${currentUser.efficiency}%`;
            document.querySelector('.efficiency-circle').style.background = `conic-gradient(var(--primary) ${currentUser.efficiency}%, #e9ecef 0%)`;
            
            // Cargar últimos pagos
            loadUltimosPagos();
            
            // Cargar próximos vencimientos
            loadProximosVencimientos();
        }
        
        // Función para calcular la eficiencia del cobrador
        function calculateEfficiency() {
            const userCredits = credits.filter(c => c.userId === currentUser.id);
            const userPayments = payments.filter(p => p.userId === currentUser.id);
            
            // Calcular el total de créditos asignados
            const totalAssigned = userCredits.reduce((sum, credit) => sum + credit.amount, 0);
            
            // Calcular el total de pagos recibidos
            const totalCollected = userPayments.reduce((sum, payment) => sum + payment.amount, 0);
            
            // Calcular eficiencia (porcentaje de cobrado vs asignado)
            const efficiency = totalAssigned > 0 ? (totalCollected / totalAssigned) * 100 : 0;
            
            // Actualizar eficiencia del usuario
            currentUser.efficiency = efficiency.toFixed(1);
            
            // Ajustar la comisión según la eficiencia
            if (efficiency >= 90) {
                currentUser.commissionRate = 0.08; // 8% de comisión por alta eficiencia
            } else if (efficiency >= 70) {
                currentUser.commissionRate = 0.06; // 6% de comisión por eficiencia media
            } else {
                currentUser.commissionRate = 0.05; // 5% de comisión base
            }
            
            // Actualizar usuario en el almacenamiento
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex] = currentUser;
                localStorage.setItem('loanUsers', JSON.stringify(users));
                localStorage.setItem('loggedInUser', JSON.stringify(currentUser));
            }
        }
        
        // Función para cargar los últimos pagos en el dashboard
        function loadUltimosPagos() {
            const userPayments = payments.filter(p => p.userId === currentUser.id);
            const ultimosPagos = userPayments
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 5);
            
            const pagosTable = document.getElementById('ultimos-pagos-table');
            pagosTable.innerHTML = '';
            
            if (ultimosPagos.length === 0) {
                pagosTable.innerHTML = '<tr><td colspan="3" class="text-center py-4">No hay pagos recientes</td></tr>';
                return;
            }
            
            ultimosPagos.forEach(pago => {
                const credito = credits.find(c => c.id === pago.creditId);
                const cliente = clients.find(c => c.id === credito.clientId);
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${cliente ? cliente.name : 'Cliente no encontrado'}</td>
                    <td>$${pago.amount.toFixed(2)}</td>
                    <td>${new Date(pago.date).toLocaleDateString()}</td>
                `;
                
                pagosTable.appendChild(tr);
            });
        }
        
        // Función para cargar los próximos vencimientos
        function loadProximosVencimientos() {
            const userCredits = credits.filter(c => c.userId === currentUser.id && c.balance > 0);
            const today = new Date();
            const nextWeek = new Date(today);
            nextWeek.setDate(today.getDate() + 7);
            
            const proximosVencimientos = userCredits.filter(credito => {
                // Calcular la próxima fecha de pago (simulación simple)
                const nextPaymentDate = new Date(credito.nextPaymentDate || credito.date);
                return nextPaymentDate >= today && nextPaymentDate <= nextWeek;
            });
            
            const tableBody = document.getElementById('proximos-vencimientos-table');
            tableBody.innerHTML = '';
            
            if (proximosVencimientos.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="3" class="text-center py-4">No hay vencimientos próximos</td></tr>';
                return;
            }
            
            proximosVencimientos.forEach(credito => {
                const cliente = clients.find(c => c.id === credito.clientId);
                const nextPaymentDate = new Date(credito.nextPaymentDate || credito.date);
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${cliente ? cliente.name : 'Cliente no encontrado'}</td>
                    <td>$${credito.installment.toFixed(2)}</td>
                    <td>${nextPaymentDate.toLocaleDateString()}</td>
                `;
                
                tableBody.appendChild(tr);
            });
        }
        
        // Función para cargar la tabla de clientes
        function loadClientesTable() {
            const userClients = clients.filter(c => c.userId === currentUser.id);
            const tableBody = document.getElementById('clientes-table').querySelector('tbody');
            tableBody.innerHTML = '';
            
            if (userClients.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="6" class="text-center py-4">No hay clientes registrados</td></tr>';
                return;
            }
            
            userClients.forEach(cliente => {
                // Contar créditos activos del cliente
                const clientCredits = credits.filter(c => c.clientId === cliente.id && c.balance > 0);
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${cliente.name}</td>
                    <td>${cliente.phone || 'N/A'}</td>
                    <td>${cliente.email || 'N/A'}</td>
                    <td>${cliente.address || 'N/A'}</td>
                    <td>${clientCredits.length}</td>
                    <td>
                        <button class="btn btn-sm btn-action btn-outline-primary edit-cliente" data-id="${cliente.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-action btn-outline-danger delete-cliente" data-id="${cliente.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                tableBody.appendChild(tr);
            });
            
            // Asignar eventos a los botones de editar y eliminar
            document.querySelectorAll('.edit-cliente').forEach(btn => {
                btn.addEventListener('click', function() {
                    const clientId = this.getAttribute('data-id');
                    editCliente(clientId);
                });
            });
            
            document.querySelectorAll('.delete-cliente').forEach(btn => {
                btn.addEventListener('click', function() {
                    const clientId = this.getAttribute('data-id');
                    deleteCliente(clientId);
                });
            });
        }
        
        // Función para editar un cliente
        function editCliente(clientId) {
            const cliente = clients.find(c => c.id === clientId);
            if (!cliente) return;
            
            document.getElementById('clienteModalTitle').textContent = 'Editar Cliente';
            document.getElementById('cliente-id').value = cliente.id;
            document.getElementById('cliente-nombre').value = cliente.name;
            document.getElementById('cliente-telefono').value = cliente.phone || '';
            document.getElementById('cliente-email').value = cliente.email || '';
            document.getElementById('cliente-direccion').value = cliente.address || '';
            
            const modal = new bootstrap.Modal(document.getElementById('clienteModal'));
            modal.show();
        }
        
        // Función para eliminar un cliente
        function deleteCliente(clientId) {
            if (!confirm('¿Estás seguro de que deseas eliminar este cliente? También se eliminarán sus créditos y pagos asociados.')) {
                return;
            }
            
            // Eliminar cliente
            clients = clients.filter(c => c.id !== clientId);
            
            // Eliminar créditos asociados
            const creditsToDelete = credits.filter(c => c.clientId === clientId);
            credits = credits.filter(c => c.clientId !== clientId);
            
            // Eliminar pagos asociados
            const creditIds = creditsToDelete.map(c => c.id);
            payments = payments.filter(p => !creditIds.includes(p.creditId));
            
            // Guardar cambios
            localStorage.setItem('loanClients', JSON.stringify(clients));
            localStorage.setItem('loanCredits', JSON.stringify(credits));
            localStorage.setItem('loanPayments', JSON.stringify(payments));
            
            // Recargar tabla
            loadClientesTable();
            
            // Actualizar dashboard si está visible
            if (document.getElementById('dashboard-section').classList.contains('active')) {
                updateDashboard();
            }
        }
        
        // Función para guardar un cliente (nuevo or editado)
        function saveCliente() {
            const clientId = document.getElementById('cliente-id').value;
            const name = document.getElementById('cliente-nombre').value;
            const phone = document.getElementById('cliente-telefono').value;
            const email = document.getElementById('cliente-email').value;
            const address = document.getElementById('cliente-direccion').value;
            
            if (!name) {
                alert('El nombre es obligatorio');
                return;
            }
            
            if (clientId) {
                // Editar cliente existente
                const index = clients.findIndex(c => c.id === clientId);
                if (index !== -1) {
                    clients[index] = {
                        ...clients[index],
                        name,
                        phone,
                        email,
                        address
                    };
                }
            } else {
                // Crear nuevo cliente
                const newClient = {
                    id: Date.now().toString(),
                    userId: currentUser.id,
                    name,
                    phone,
                    email,
                    address,
                    createdAt: new Date().toISOString()
                };
                
                clients.push(newClient);
            }
            
            // Guardar en localStorage
            localStorage.setItem('loanClients', JSON.stringify(clients));
            
            // Cerrar modal y recargar tabla
            const modal = bootstrap.Modal.getInstance(document.getElementById('clienteModal'));
            modal.hide();
            
            loadClientesTable();
            
            // Actualizar dashboard si está visible
            if (document.getElementById('dashboard-section').classList.contains('active')) {
                updateDashboard();
            }
        }
        
        // Función para resetear el formulario de cliente
        function resetClienteForm() {
            document.getElementById('clienteModalTitle').textContent = 'Nuevo Cliente';
            document.getElementById('cliente-form').reset();
            document.getElementById('cliente-id').value = '';
        }
        
        // Función para cargar la tabla de créditos
        function loadCreditosTable() {
            const userCredits = credits.filter(c => c.userId === currentUser.id);
            const tableBody = document.getElementById('creditos-table').querySelector('tbody');
            tableBody.innerHTML = '';
            
            if (userCredits.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="8" class="text-center py-4">No hay créditos registrados</td></tr>';
                return;
            }
            
            userCredits.forEach(credito => {
                const cliente = clients.find(c => c.id === credito.clientId);
                
                // Determinar el estado del crédito
                let statusBadge;
                if (credito.balance <= 0) {
                    statusBadge = '<span class="badge bg-success">Pagado</span>';
                } else if (credito.balance < credito.amount) {
                    statusBadge = '<span class="badge bg-warning">En progreso</span>';
                } else {
                    statusBadge = '<span class="badge bg-danger">Pendiente</span>';
                }
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${cliente ? cliente.name : 'Cliente no encontrado'}</td>
                    <td>$${credito.amount.toFixed(2)}</td>
                    <td>${new Date(credito.date).toLocaleDateString()}</td>
                    <td>$${credito.installment.toFixed(2)}</td>
                    <td>${credito.interestRate}%</td>
                    <td>${statusBadge}</td>
                    <td>$${credito.balance.toFixed(2)}</td>
                    <td>
                        <button class="btn btn-sm btn-action btn-outline-primary edit-credito" data-id="${credito.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-action btn-outline-danger delete-credito" data-id="${credito.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                tableBody.appendChild(tr);
            });
            
            // Asignar eventos a los botones de editar y eliminar
            document.querySelectorAll('.edit-credito').forEach(btn => {
                btn.addEventListener('click', function() {
                    const creditId = this.getAttribute('data-id');
                    editCredito(creditId);
                });
            });
            
            document.querySelectorAll('.delete-credito').forEach(btn => {
                btn.addEventListener('click', function() {
                    const creditId = this.getAttribute('data-id');
                    deleteCredito(creditId);
                });
            });
        }
        
        // Función para cargar las opciones de clientes en el select
        function loadClientOptions() {
            const userClients = clients.filter(c => c.userId === currentUser.id);
            const select = document.getElementById('credito-cliente');
            
            // Guardar la selección actual
            const currentSelection = select.value;
            
            // Limpiar opciones excepto la primera
            while (select.options.length > 1) {
                select.remove(1);
            }
            
            // Agregar opciones de clientes
            userClients.forEach(cliente => {
                const option = document.createElement('option');
                option.value = cliente.id;
                option.textContent = cliente.name;
                select.appendChild(option);
            });
            
            // Mostrar mensaje si no hay clientes
            if (userClients.length === 0) {
                const option = document.createElement('option');
                option.value = "";
                option.textContent = "No hay clientes registrados";
                option.disabled = true;
                option.selected = true;
                select.appendChild(option);
            }
            
            // Restaurar selección si existe
            if (currentSelection) {
                select.value = currentSelection;
            }
        }
        
        // Función para editar un crédito
        function editCredito(creditId) {
            const credito = credits.find(c => c.id === creditId);
            if (!credito) return;
            
            document.getElementById('creditoModalTitle').textContent = 'Editar Crédito';
            document.getElementById('credito-id').value = credito.id;
            document.getElementById('credito-cliente').value = credito.clientId;
            document.getElementById('credito-monto').value = credito.amount;
            document.getElementById('credito-fecha').value = credito.date.split('T')[0];
            document.getElementById('credito-plazo').value = credito.term;
            document.getElementById('credito-interes').value = credito.interestRate;
            
            const modal = new bootstrap.Modal(document.getElementById('creditoModal'));
            modal.show();
        }
        
        // Función para eliminar un crédito
        function deleteCredito(creditId) {
            if (!confirm('¿Estás seguro de que deseas eliminar este crédito? También se eliminarán los pagos asociados.')) {
                return;
            }
            
            // Eliminar crédito
            credits = credits.filter(c => c.id !== creditId);
            
            // Eliminar pagos asociados
            payments = payments.filter(p => p.creditId !== creditId);
            
            // Guardar cambios
            localStorage.setItem('loanCredits', JSON.stringify(credits));
            localStorage.setItem('loanPayments', JSON.stringify(payments));
            
            // Recargar tabla
            loadCreditosTable();
            
            // Actualizar dashboard si está visible
            if (document.getElementById('dashboard-section').classList.contains('active')) {
                updateDashboard();
            }
        }
        
        // Función para guardar un crédito (nuevo o editado)
        function saveCredito() {
            const creditId = document.getElementById('credito-id').value;
            const clientId = document.getElementById('credito-cliente').value;
            const amount = parseFloat(document.getElementById('credito-monto').value);
            const date = document.getElementById('credito-fecha').value;
            const term = parseInt(document.getElementById('credito-plazo').value);
            const interestRate = parseFloat(document.getElementById('credito-interes').value);
            
            if (!clientId || !amount || !date || !term || !interestRate) {
                alert('Todos los campos son obligatorios');
                return;
            }
            
            // Calcular la cuota mensual (fórmula simplificada)
            const monthlyInterest = interestRate / 100;
            const installment = (amount * monthlyInterest) / (1 - Math.pow(1 + monthlyInterest, -term));
            
            if (creditId) {
                // Editar crédito existente
                const index = credits.findIndex(c => c.id === creditId);
                if (index !== -1) {
                    credits[index] = {
                        ...credits[index],
                        clientId,
                        amount,
                        date,
                        term,
                        interestRate,
                        installment,
                        // Mantener el balance actual al editar
                        balance: credits[index].balance
                    };
                }
            } else {
                // Crear nuevo crédito
                const newCredit = {
                    id: Date.now().toString(),
                    userId: currentUser.id,
                    clientId,
                    amount,
                    date,
                    term,
                    interestRate,
                    installment,
                    balance: amount, // Saldo inicial igual al monto del crédito
                    createdAt: new Date().toISOString()
                };
                
                credits.push(newCredit);
            }
            
            // Guardar en localStorage
            localStorage.setItem('loanCredits', JSON.stringify(credits));
            
            // Cerrar modal y recargar tabla
            const modal = bootstrap.Modal.getInstance(document.getElementById('creditoModal'));
            modal.hide();
            
            loadCreditosTable();
            
            // Actualizar dashboard si está visible
            if (document.getElementById('dashboard-section').classList.contains('active')) {
                updateDashboard();
            }
        }
        
        // Función para resetear el formulario de crédito
        function resetCreditoForm() {
            document.getElementById('creditoModalTitle').textContent = 'Nuevo Crédito';
            document.getElementById('credito-form').reset();
            document.getElementById('credito-id').value = '';
        }
        
        // Función para cargar la tabla de pagos
        function loadPagosTable() {
            const userPayments = payments.filter(p => p.userId === currentUser.id);
            const tableBody = document.getElementById('pagos-table').querySelector('tbody');
            tableBody.innerHTML = '';
            
            if (userPayments.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="6" class="text-center py-4">No hay pagos registrados</td></tr>';
                return;
            }
            
            userPayments.forEach(pago => {
                const credito = credits.find(c => c.id === pago.creditId);
                const cliente = credito ? clients.find(c => c.id === credito.clientId) : null;
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${cliente ? cliente.name : 'Cliente no encontrado'}</td>
                    <td>$${credito ? credito.amount.toFixed(2) : 'N/A'}</td>
                    <td>${new Date(pago.date).toLocaleDateString()}</td>
                    <td>$${pago.amount.toFixed(2)}</td>
                    <td>${pago.method}</td>
                    <td>
                        <button class="btn btn-sm btn-action btn-outline-danger delete-pago" data-id="${pago.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                tableBody.appendChild(tr);
            });
            
            // Asignar eventos a los botones de eliminar
            document.querySelectorAll('.delete-pago').forEach(btn => {
                btn.addEventListener('click', function() {
                    const paymentId = this.getAttribute('data-id');
                    deletePago(paymentId);
                });
            });
        }
        
        // Función para cargar las opciones de créditos en el select
        function loadCreditOptions() {
            const userCredits = credits.filter(c => c.userId === currentUser.id && c.balance > 0);
            const select = document.getElementById('pago-credito');
            
            // Guardar la selección actual
            const currentSelection = select.value;
            
            // Limpiar opciones excepto la primera
            while (select.options.length > 1) {
                select.remove(1);
            }
            
            // Agregar opciones de créditos
            userCredits.forEach(credito => {
                const cliente = clients.find(c => c.id === credito.clientId);
                const option = document.createElement('option');
                option.value = credito.id;
                option.textContent = `${cliente ? cliente.name : 'Cliente'} - $${credito.balance.toFixed(2)} pendiente`;
                select.appendChild(option);
            });
            
            // Mostrar mensaje si no hay créditos
            if (userCredits.length === 0) {
                const option = document.createElement('option');
                option.value = "";
                option.textContent = "No hay créditos activos";
                option.disabled = true;
                option.selected = true;
                select.appendChild(option);
            }
            
            // Restaurar selección si existe
            if (currentSelection) {
                select.value = currentSelection;
            }
        }
        
        // Función para eliminar un pago
        function deletePago(paymentId) {
            if (!confirm('¿Estás seguro de que deseas eliminar este pago?')) {
                return;
            }
            
            const pago = payments.find(p => p.id === paymentId);
            if (!pago) return;
            
            // Encontrar el crédito asociado
            const credito = credits.find(c => c.id === pago.creditId);
            if (credito) {
                // Restaurar el balance del crédito
                credito.balance += pago.amount;
                
                // Actualizar el crédito en el almacenamiento
                const creditIndex = credits.findIndex(c => c.id === credito.id);
                if (creditIndex !== -1) {
                    credits[creditIndex] = credito;
                }
            }
            
            // Eliminar pago
            payments = payments.filter(p => p.id !== paymentId);
            
            // Guardar cambios
            localStorage.setItem('loanCredits', JSON.stringify(credits));
            localStorage.setItem('loanPayments', JSON.stringify(payments));
            
            // Recargar tabla
            loadPagosTable();
            
            // Actualizar dashboard si está visible
            if (document.getElementById('dashboard-section').classList.contains('active')) {
                updateDashboard();
            }
        }
        
        // Función para guardar un pago
        function savePago() {
            const creditId = document.getElementById('pago-credito').value;
            const amount = parseFloat(document.getElementById('pago-monto').value);
            const date = document.getElementById('pago-fecha').value;
            const method = document.getElementById('pago-metodo').value;
            
            if (!creditId || !amount || !date || !method) {
                alert('Todos los campos son obligatorios');
                return;
            }
            
            // Verificar que el crédito existe
            const credito = credits.find(c => c.id === creditId);
            if (!credito) {
                alert('El crédito seleccionado no existe');
                return;
            }
            
            // Verificar que el monto no excede el saldo pendiente
            if (amount > credito.balance) {
                alert('El monto del pago no puede exceder el saldo pendiente del crédito');
                return;
            }
            
            // Crear nuevo pago
            const newPayment = {
                id: Date.now().toString(),
                userId: currentUser.id,
                creditId,
                amount,
                date,
                method,
                createdAt: new Date().toISOString()
            };
            
            payments.push(newPayment);
            
            // Actualizar el balance del crédito
            credito.balance -= amount;
            
            // Si el crédito está completamente pagado, actualizar estado
            if (credito.balance <= 0) {
                credito.balance = 0;
                // Aquí podrías agregar lógica adicional para créditos pagados
            }
            
            // Actualizar el crédito en el array
            const creditIndex = credits.findIndex(c => c.id === creditId);
            if (creditIndex !== -1) {
                credits[creditIndex] = credito;
            }
            
            // Guardar en localStorage
            localStorage.setItem('loanPayments', JSON.stringify(payments));
            localStorage.setItem('loanCredits', JSON.stringify(credits));
            
            // Cerrar modal y recargar tabla
            const modal = bootstrap.Modal.getInstance(document.getElementById('pagoModal'));
            modal.hide();
            
            loadPagosTable();
            
            // Actualizar dashboard si está visible
            if (document.getElementById('dashboard-section').classList.contains('active')) {
                updateDashboard();
            }
        }
        
        // Función para resetear el formulario de pago
        function resetPagoForm() {
            document.getElementById('pago-form').reset();
            document.getElementById('pago-id').value = '';
        }
        
        // Función para cargar datos de la sección de objetivo mensual
        function loadObjetivoData() {
            document.getElementById('objetivo-mensual').value = currentUser.monthlyGoal || 0;
            
            // Calcular total cobrado en el mes actual
            const currentDate = new Date();
            const currentMonth = currentDate.getMonth();
            const currentYear = currentDate.getFullYear();
            
            const userPayments = payments.filter(p => p.userId === currentUser.id);
            const currentMonthPayments = userPayments.filter(p => {
                const paymentDate = new Date(p.date);
                return paymentDate.getMonth() === currentMonth && 
                       paymentDate.getFullYear() === currentYear;
            });
            
            const totalCollected = currentMonthPayments.reduce((sum, p) => sum + p.amount, 0);
            const monthlyGoal = currentUser.monthlyGoal || 0;
            const percentage = monthlyGoal > 0 ? (totalCollected / monthlyGoal) * 100 : 0;
            
            // Actualizar UI
            document.getElementById('total-cobrado-mes').textContent = `$${totalCollected.toFixed(2)}`;
            document.getElementById('objetivo-actual-mes').textContent = `$${monthlyGoal.toFixed(2)}`;
            document.getElementById('porcentaje-cumplimiento').textContent = `${percentage.toFixed(1)}%`;
            
            const progressBar = document.getElementById('progress-bar-cumplimiento');
            progressBar.style.width = `${percentage}%`;
            progressBar.setAttribute('aria-valuenow', percentage);
            
            // Asignar clase de color según el porcentaje
            if (percentage >= 100) {
                progressBar.className = 'progress-bar bg-success';
            } else if (percentage >= 70) {
                progressBar.className = 'progress-bar bg-warning';
            } else {
                progressBar.className = 'progress-bar bg-danger';
            }
        }
        
        // Función para manejar el establecimiento del objetivo mensual
        function handleObjetivo(e) {
            e.preventDefault();
            const monthlyGoal = parseFloat(document.getElementById('objetivo-mensual').value);
            
            if (isNaN(monthlyGoal) || monthlyGoal < 0) {
                alert('Por favor ingresa un objetivo válido');
                return;
            }
            
            // Actualizar objetivo del usuario
            currentUser.monthlyGoal = monthlyGoal;
            
            // Actualizar usuario en el almacenamiento
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex] = currentUser;
                localStorage.setItem('loanUsers', JSON.stringify(users));
                localStorage.setItem('loggedInUser', JSON.stringify(currentUser));
            }
            
            alert('Objetivo mensual actualizado correctamente');
            
            // Actualizar datos mostrados
            loadObjetivoData();
            
            // Actualizar dashboard si está visible
            if (document.getElementById('dashboard-section').classList.contains('active')) {
                updateDashboard();
            }
        }
        
        // Función para inicializar el gráfico de reportes
        function initReportsChart() {
            const ctx = document.getElementById('pagos-chart').getContext('2d');
            const chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Pagos Mensuales',
                        data: [1200, 1900, 1500, 2100, 1800, 2200],
                        backgroundColor: 'rgba(67, 97, 238, 0.5)',
                        borderColor: 'rgba(67, 97, 238, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Función para cargar datos de reportes
        function loadReportsData() {
            // Esta función cargaría datos reales para los reportes
            // Por ahora solo inicializamos el gráfico
            initReportsChart();
        }
        
        // Función para generar reportes
        function generateReport(e) {
            e.preventDefault();
            const tipo = document.getElementById('reporte-tipo').value;
            const fecha = document.getElementById('reporte-fecha').value;
            
            alert(`Generando reporte de ${tipo} para ${fecha}`);
            // Aquí iría la lógica real para generar el reporte
        }
    </script>
</body>
</html>